var frmViewsDom={},frmViewsModal={},frmViewsUtil={},frmViewsTable={};
(function(){var __=wp.i18n.__;function tag(type,args){var has,setupAttrs,setupTagStyles,setupClasses,setupContent,setupOnClick,output=document.createElement(type);if("undefined"===typeof args)return output;has=makeHas(args);setupAttrs=function(){var callback=function(attr){if(has(attr))output.setAttribute(attr,args[attr])};each(getSupportedSetupAttrs(type),callback)};setupTagStyles=function(){var callback=function(style){if(has(style))output.style[style]=args[style]};each(getSupportedTagStyles(),
callback)};setupClasses=function(){if(has("class"))if("string"===typeof args.class)output.classList.add(args.class);else each(args.class,function(currentClass){output.classList.add(currentClass)})};setupContent=function(){var clone;if(has("text"))output.textContent=args.text;else if(has("children"))each(args.children,function(child){output.appendChild(child)});else if(has("child"))output.appendChild(args.child);else if(has("icon")){clone=document.getElementById(args.icon).cloneNode(true);clone.id=
"";output.appendChild(clone);if(has("backgroundColor")){output.style.backgroundColor=args.backgroundColor;output.style.color="#fff"}}else if(has("html"))output.innerHTML=args.html};setupOnClick=function(){var callback,on,preventDefault=false;if(has("onclick"))callback=args.onclick;else{if(!has("onclickPreventDefault"))return;preventDefault=true;callback=args.onclickPreventDefault}if(!has("id")){console.warn("formidable-views: please provide an id when setting an onclick");return}if(preventDefault)on=
function(event){event.preventDefault();callback(event)};else on=callback;jQuery(document).off("click","#"+args.id);jQuery(document).on("click","#"+args.id,on)};setupAttrs();setupTagStyles();setupClasses();setupContent();setupOnClick();return output}function getSupportedSetupAttrs(type){var attrs=["id","role"];if("label"===type)attrs.push("for");return attrs}function getSupportedTagStyles(){return["padding","margin","border","fontSize","color","opacity","position","textAlign"]}function div(args){return tag("div",
args)}function span(args){return tag("span",args)}function emptyNode(){return document.createTextNode("")}function a(args){var output=tag("a",args);if("undefined"===typeof args.href)args.href="#";if("undefined"!==typeof args.target)output.target=args.target;output.setAttribute("href",args.href);return output}function button(args){if("undefined"===typeof args.class)args.class=[];else if(!Array.isArray(args.class))args.class=[args.class];args.class.push("button");if(-1!==args.class.indexOf("frm-button-secondary"))args.class.push("button-secondary");
else if(-1===args.class.indexOf("frm-views-modal-cancel-button"))args.class.push("button-primary","frm-button-primary");return a(args)}function select(options,args){var output=tag("select",{children:options}),has=makeHas(args);if(has("id")&&has("onchange")){output.id=args.id;jQuery(document).off("change","#"+args.id);jQuery(document).on("change","#"+args.id,args.onchange)}return output}function option(value,textContent,isSelected){var output=document.createElement("option");output.setAttribute("value",
value);output.textContent=textContent;if(isSelected)output.setAttribute("selected","selected");return output}function pullOptionsFrom(templateId,selectedValue){var optionElements,optionIndex,currentOption,currentOptionValue,isSelected,template=document.getElementById(templateId),options=[];if(null===template)return options;if("number"===typeof selectedValue)selectedValue=selectedValue.toString();optionElements=template.querySelectorAll("option");for(optionIndex=0;optionIndex<optionElements.length;++optionIndex){currentOption=
optionElements[optionIndex];currentOptionValue=currentOption.getAttribute("value");if(""!==currentOptionValue){isSelected=currentOptionValue===selectedValue;options.push(option(currentOptionValue,currentOption.textContent,isSelected))}}return options}function radios(options,name){var keys=Object.keys(options);return span({children:map(keys,function(key){return input({id:"radio_"+name+"_"+key,name:name,type:"radio",label:options[key],value:key})}),class:"frm-dom-radios"})}function input(args){var label,
setInputAttribute,has=makeHas(args),output=tag("input",args);if(!has("type"))args.type="text";setInputAttribute=function(attr){if(has(attr))output[attr]=args[attr]};each(getSupportedInputAttrs(),setInputAttribute);if(has("label")){label=tag("label",{text:args.label});if(has("id"))label.setAttribute("for",args.id);output=div({children:[div({child:label}),output]})}if(has("onchange"))if(has("id"))jQuery(document).on("change","#"+args.id,args.onchange);else console.warn("formidable-views: please provide an id when setting an onchange");
return output}function getSupportedInputAttrs(){return["value","placeholder","type","name"]}function tabs(items,args){var passArgs,addTab,outputArgs,has=makeHas(args),state={},children=[];if(has("active"))state.activeTab=args.active;else if("undefined"!==items[0].pageKey)state.activeTab=items[0].pageKey;else state.activeTab=items[0].text;passArgs=function(tabArgs,key,mapKey){if(!has(key))return;if("undefined"!==typeof mapKey)tabArgs[mapKey]=args[key];else tabArgs[key]=args[key]};addTab=function(tabArgs,
index){var newTab;passArgs(tabArgs,"tabClass","class");passArgs(tabArgs,"pageWrapper");passArgs(tabArgs,"stateHandler");newTab=tab(tabArgs,index,state);if(newTab.classList.contains("frm-active-tab"))state.activeTabElement=newTab;children.push(newTab)};each(items,addTab);outputArgs={children:children};if(has("wrapperClass"))outputArgs.class=args.wrapperClass;return div(outputArgs)}function tab(tabArgs,index,state){var element,onclick,isActive,setPage,has=makeHas(tabArgs);if(!has("pageKey"))tabArgs.pageKey=
tabArgs.text;isActive=function(index){return tabArgs.pageKey===state.activeTab};setPage=function(){if(has("page")&&has("pageWrapper")){if(has("stateHandler")&&has("pageKey"))tabArgs.stateHandler(tabArgs.pageKey);redraw(tabArgs.pageWrapper,tabArgs.page())}};if(!Array.isArray(tabArgs.class))tabArgs.class=[tabArgs.class];if(isActive(index))tabArgs.class.push("frm-active-tab");if("undefined"!==typeof tabArgs.onclick)onclick=tabArgs.onclick;else onclick=function(){};tabArgs.onclick=function(){state.activeTabElement.classList.remove("frm-active-tab");
element.classList.add("frm-active-tab");state.activeTabElement=element;setPage();onclick()};element=div(tabArgs);if(isActive())setPage();return element}function collapsible(header,child,args){var content,section,classes=["accordion-section"],has=makeHas(args),open=has("open")&&args.open;header.classList.add("accordion-section-title");header.onclick=function(){open=!open;content.setAttribute("aria-expanded",open);jQuery(section).toggleClass("open",open);if(section.classList.contains("open"))tryToFocusOnFirstAvailableField(section)};
content=div({child:child,class:"accordion-section-content"});content.setAttribute("aria-expanded",open);if(open)classes.push("open");section=div({children:[header,content],class:classes});return section}function tryToFocusOnFirstAvailableField(section){var field=section.querySelector("input");if(null===field)field=section.querySelector("textarea");if(null!==field)field.focus()}function redraw(element,child){element.innerHTML="";element.appendChild(child)}function maybeCreateModal(args){var metaboxHolder,
postbox,top,title,modal,top,content,footer,modalHelper,has=makeHas(args);if("undefined"===typeof args)args={};if(has("id"))modal=document.getElementById(args.id);if(null===modal||"undefined"===typeof modal){modal=div({class:"frm-modal"});if(has("id"))modal.id=args.id;postbox=div({class:"postbox"});metaboxHolder=div({class:"metabox-holder",child:postbox});modal.appendChild(metaboxHolder);document.body.appendChild(modal)}postbox=modal.querySelector(".postbox");modalHelper=getModalHelper(modal,postbox);
if(has("title")){title=modal.querySelector(".frm-modal-title");if(null===title){title=div({child:document.createTextNode(args.title),class:"frm-modal-title"});top=modal.querySelector(".frm_modal_top");if(null===top){top=div({class:"frm_modal_top",children:[title,div({child:a({text:__("Cancel","formidable-views"),class:"dismiss"})})]});postbox.appendChild(top)}}else title.innerHTML=div({child:document.createTextNode(args.title)}).innerHTML}if(has("content"))modalHelper(args.content,"frm_modal_content");
if(has("footer"))modalHelper(args.footer,"frm_modal_footer");makeModalIntoADialogAndOpen(modal);return modal}function getModalHelper(modal,appendTo){return function(child,uniqueClassName){var element=modal.querySelector("."+uniqueClassName);if(null===element){element=div({child:child,class:uniqueClassName});appendTo.appendChild(element)}else redraw(element,child)}}function makeModalIntoADialogAndOpen(modal){var $modal=jQuery(modal);if(!$modal.hasClass("frm-dialog"))$modal.dialog({dialogClass:"frm-dialog",
modal:true,autoOpen:false,closeOnEscape:true,width:"550px",resizable:false,draggable:false,open:function(){jQuery(".ui-dialog-titlebar").addClass("frm_hidden").removeClass("ui-helper-clearfix");jQuery("#wpwrap").addClass("frm_overlay");jQuery(".frm-dialog").removeClass("ui-widget ui-widget-content ui-corner-all");$modal.removeClass("ui-dialog-content ui-widget-content");jQuery(".ui-widget-overlay, a.dismiss").bind("click",function(event){event.preventDefault();$modal.dialog("close")})},close:function(){jQuery("#wpwrap").removeClass("frm_overlay");
jQuery(".spinner").css("visibility","hidden")}});scrollToTop();$modal.dialog("open");return $modal}function scrollToTop(){if("scrollRestoration"in history)history.scrollRestoration="manual";window.scrollTo(0,0)}function recenterModal(modalId){jQuery(document.getElementById(modalId)).dialog("option","position",{my:"center",at:"center",of:window})}function each(items,callback){var index,length=items.length;for(index=0;index<length;index++)callback(items[index],index)}function map(items,callback){var output=
[];each(items,function(item,index){output.push(callback(item,index))});return output}function makeHas(args){if("undefined"===typeof args)return function(){return false};return function(key){return"undefined"!==typeof args[key]}}function post(data,success,error){var handleSuccessCallback=function(responseData){if("function"===typeof success)success(responseData)};jQuery.ajax({type:"POST",url:ajaxurl,data:data,success:function(response){if("undefined"!==typeof response.success&&response.success){if("undefined"===
typeof response.data){handleSuccessCallback({});return}handleSuccessCallback(response.data);if("undefined"!==typeof response.data.redirect)window.location=response.data.redirect}else if("function"===typeof error)error(response)},error:error})}function success(content){var container,notice;container=document.getElementById("wpbody");notice=div({class:["notice","notice-info","frm-review-notice","frm_updated_message"],child:div({class:"frm-satisfied",child:content})});notice.style.borderRadius="4px";
notice.style.right="10px";container.appendChild(notice);setTimeout(function(){jQuery(notice).fadeOut(function(){notice.remove()})},2E3)}function getTableSelectAllAndSearchOptions(){return div({class:"frm_grid_container",margin:"0 0 20px",children:[div({class:"frm_fourth",padding:"10px 0 0 ",child:a({id:"frm_table_columns_select_all",onclickPreventDefault:function(){toggleAllColumnOptions(true)},text:__("Select all","formidable-views")})}),div({class:"frm_fourth",padding:"10px 0 0 ",child:a({id:"frm_table_columns_deselect_all",
onclickPreventDefault:function(){toggleAllColumnOptions(false)},text:__("Deselect all","formidable-views")})}),div({class:"frm_half",child:getTableColumnOptionSearch()})]})}function toggleAllColumnOptions(checked){each(document.querySelectorAll(".frm-new-table-view-option input"),function(option){option.checked=checked})}function getTableColumnOptionSearch(){var search=input({class:["frm-search-input","frm-auto-search"]});search.setAttribute("type","search");search.setAttribute("name","s");search.setAttribute("placeholder",
__("Search for a form field","formidable-views")),search.setAttribute("data-tosearch","frm-new-table-view-option");return tag("p",{class:"frm-search",children:[span({class:["frmfont","frm_search_icon"]}),search]})}frmViewsDom.tag=tag;frmViewsDom.div=div;frmViewsDom.span=span;frmViewsDom.emptyNode=emptyNode;frmViewsDom.a=a;frmViewsDom.button=button;frmViewsDom.select=select;frmViewsDom.option=option;frmViewsDom.pullOptionsFrom=pullOptionsFrom;frmViewsDom.radios=radios;frmViewsDom.input=input;frmViewsDom.tabs=
tabs;frmViewsDom.collapsible=collapsible;frmViewsDom.redraw=redraw;frmViewsDom.success=success;frmViewsModal.maybeCreateModal=maybeCreateModal;frmViewsModal.recenterModal=recenterModal;frmViewsUtil.each=each;frmViewsUtil.map=map;frmViewsUtil.makeHas=makeHas;frmViewsUtil.post=post;frmViewsTable.getTableSelectAllAndSearchOptions=getTableSelectAllAndSearchOptions})();(function(){var tag,div,span,a,input,emptyNode,button,select,option,pullOptionsFrom,maybeCreateModal,post,each,map,getTableSelectAllAndSearchOptions,__=wp.i18n.__,registeredModalListeners=false,currentAutoId=0,state={viewName:""};function triggerSelectViewType(){return maybeCreateModal({id:"frm_new_view_modal",title:__("Select View type","formidable-views"),content:selectViewTypeContent(),footer:selectViewTypeFooter()})}function triggerStepTwo(type){state.viewName="undefined"!==typeof frmSelectedFormName?
frmSelectedFormName+" "+getTypeSuffix(type):"";return maybeCreateModal({id:"frm_new_view_modal",title:getStepTwoTitle(),content:selectDataSourceContent(type),footer:selectDataSourceFooter(type)})}function getStepTwoTitle(){return getFormIdFromUrl()?__("Create new view","formidable-views"):__("Select Data Source","formidable-views")}function triggerCreateView(formId,type){var data={action:"frm_views_editor_create",form:formId,type:type,nonce:frmGlobal.nonce,name:getViewName()};if("table"===type)data.tableOptions=
getSelectedTableOptionFieldValues();post(data)}function getViewName(){return state.viewName}function getSelectedTableOptionFieldValues(){var fieldValues=[];each(document.querySelectorAll(".frm-new-table-view-option input"),function(input){if(input.checked)fieldValues.push(input.value)});return fieldValues}function getFormIdValueFromDatasourceSelect(){return document.getElementById("frm_new_view_datasource_select").value}function onClickPreventDefault(id,callback){jQuery("#"+id).click(function(event){event.preventDefault();
callback()})}function onNewViewClick(){triggerSelectViewType();if(registeredModalListeners)return;registeredModalListeners=true;jQuery(document).on("click","#frm_new_view_modal li .frm-hover-icons .frm-create-view",function(event){var type=jQuery(this).closest("[frm-view-type]").attr("frm-view-type");event.preventDefault();triggerStepTwo(type)});jQuery(document).on("click",'#frm_new_view_modal li [role="button"]:not(a)',function(event){var $hoverIcons,$trigger,$li=jQuery(this).closest("li");$hoverIcons=
$li.find(".frm-hover-icons");if(!$hoverIcons.length){$li.trigger("mouseover");$hoverIcons=$li.find(".frm-hover-icons");$hoverIcons.hide()}$trigger=$hoverIcons.find(".frm-create-view");$trigger.click()})}function selectViewTypeContent(){var list,wrapper;list=tag("ul",{class:["frm-templates-list","frm-categories-list"],children:[getGridOption(),getTableOption(),getCalendarViewOption(),getClassicViewOption()]});wrapper=div({class:["cta-inside","frmcenter"],child:list});return div({class:"inside",child:wrapper})}
function getClassicViewOption(){return viewTypeListItem("all","frm_views_editor_classic_view_icon","#F4AD3D",__("Classic","formidable-views"),__("Create a new view from scratch","formidable-views"))}function getGridOption(){return viewTypeListItem("grid","frm_view_icon_grid","#805EF6",__("Grid","formidable-views"),__("Create a view and write less code","formidable-views"))}function getCalendarViewOption(){return viewTypeListItem("calendar","frm_views_calendar_type","rgb(65, 153, 253)",__("Calendar",
"formidable-views"),__("Insert entries into a calendar","formidable-views"))}function getTableOption(){return viewTypeListItem("table","frm_views_table_type","#68DADC",__("Table","formidable-views"),__("Insert entries into a table","formidable-views"))}function selectViewTypeFooter(){return div({class:"frmcenter",child:document.createTextNode(getCurrentStepDescription(1))})}function getCurrentStepDescription(currentStep,type){var numberOfSteps=getTotalNumberOfSteps(type);if(1===numberOfSteps)return"";
return __("%1$s of %2$s","formidable_views").replace("%1$s",currentStep).replace("%2$s",numberOfSteps)}function typeIncludesThreeSteps(type){return"table"===type}function getTotalNumberOfSteps(type){var numberOfSteps=typeIncludesThreeSteps(type)?3:2;return numberOfSteps}function getFormIdFromUrl(){var queryString=window.location.search,urlParams=new URLSearchParams(queryString);return urlParams.get("form")}function selectDataSourceContent(type){return div({children:[maybeGetComingSoon(type),getFormSelectLabel(),
getFormSelect(type),div({margin:"15px 0 0 0",children:[div({margin:"0 0 8px 0",child:tag("label",{text:__("View Name","formidable-views"),fontSize:"14px"})}),div({child:input({id:"frm_new_view_name",value:state.viewName,onchange:function(){state.viewName=this.value},fontSize:"14px"})})]})],padding:"30px"})}function getFormSelectLabel(){if(getFormIdFromUrl())return emptyNode();return div({child:tag("label",{text:__("Use Entries from Form","formidable-views"),fontSize:"14px"}),margin:"0 0 8px 0"})}
function maybeGetComingSoon(type){if(-1===["calendar"].indexOf(type))return emptyNode();return comingSoon(type)}function comingSoon(type){var icon,title;title=__("The new %1$s is coming soon.","formidable-views");switch(type){case "calendar":icon="frm_views_editor_coming_soon_calendar";title=title.replace("%1$s",__("Calendar Editor","formidable-views"));break}return div({class:["frm-coming-soon","frm_grid_container"],children:[div({class:"frm2",icon:icon}),div({class:"frm10",children:[span({class:"frm-coming-soon-pill",
text:__("COMING SOON","formidable-views")}),div({margin:"5px 0 0",children:[span({text:title}),document.createTextNode(" "),getFormidableSubscribeLink(),document.createTextNode(" "),span({text:__("to receive news about the latest updates.","formidable-views")})]})]})]})}function getFormidableSubscribeLink(){return a({text:__("Subscribe to Formidable Forms","formidable-views"),href:"https://formidableforms.com/newsletter/",target:"_blank"})}function getFormSelect(type){if(getFormIdFromUrl())return emptyNode();
return select([option("",__("Select datasource","formidable-views"))].concat(pullOptionsFrom("frm_data_source_form_select_template")),{id:"frm_new_view_datasource_select",onchange:function(){var formName=this.querySelector('option[value="'+this.value+'"]').textContent.trim();state.viewName=formName+" "+getTypeSuffix(type);document.getElementById("frm_new_view_name").value=state.viewName}})}function getTypeSuffix(type){if("all"===type||type.length<2)return"View";return type[0].toUpperCase()+type.substr(1)}
function selectDataSourceFooter(type){var backButton,pageCounter,createButton;backButton=button({text:__("Back","formidable-views"),id:"frm_select_data_source_back",onclickPreventDefault:triggerSelectViewType});pageCounter=span({class:"frm-modal-pagecounter",child:document.createTextNode(getCurrentStepDescription(2,type))});createButton=button({text:__("Create a view","formidable-views"),id:"frm_select_data_source_create",onclickPreventDefault:function(){var formId;formId=getFormIdFromUrl();if(!formId)formId=
getFormIdValueFromDatasourceSelect();if(typeIncludesThreeSteps(type)&&""!==formId)transitionToStepThree(formId,type);else triggerCreateView(formId,type)}});return div({children:[pageCounter,backButton,createButton],position:"relative"})}function transitionToStepThree(formId,type){return maybeCreateModal({id:"frm_new_view_modal",title:__("Customize view","formidable-views"),content:stepThreeContent(formId,type),footer:stepThreeFooter(formId,type)})}function stepThreeContent(formId,type){if("table"===
type)return getStepThreeContentForTableType(formId);return emptyNode()}function getStepThreeContentForTableType(formId){var placeholder=div();post({action:"frm_views_get_table_column_options",form:formId,nonce:frmGlobal.nonce},function(data){placeholder.appendChild(getTableOptionHtmlFromData(data))});return div({padding:"20px",children:[getTableSelectAllAndSearchOptions(),div({margin:"0 0 15px",text:__("Select columns that should be displayed in view","formidable-views")}),placeholder]})}function getTableOptionHtmlFromData(data){return div({class:["frm_grid_container",
"frm-table-options-container"],children:map(data.options,function(optionInfo){var checkboxId,label;checkboxId="frm_table_option_checkbox_"+autoId();label=tag("label",{text:optionInfo.label});label.setAttribute("for",checkboxId);return div({class:["frm_half","frm-new-table-view-option"],children:[getTableOptionCheckbox(optionInfo.value,checkboxId),label]})})})}function autoId(){return++currentAutoId}function getTableOptionCheckbox(value,checkboxId){var checkbox=tag("input");checkbox.id=checkboxId;
checkbox.setAttribute("type","checkbox");checkbox.value=value;return checkbox}function stepThreeFooter(formId,type){var backButton,pageCounter,createButton;backButton=button({text:__("Back","formidable-views"),id:"frm_select_data_source_back",onclickPreventDefault:function(){triggerStepTwo(type)}});pageCounter=span({class:"frm-modal-pagecounter",child:document.createTextNode(getCurrentStepDescription(3,type))});createButton=button({text:__("Create a view","formidable-views"),id:"frm_select_data_source_create",
onclickPreventDefault:function(){triggerCreateView(formId,type)}});return div({children:[pageCounter,backButton,createButton],position:"relative"})}function viewTypeListItem(type,icon,backgroundColor,title,description){var li=tag("li",{class:"frm-selectable"}),wrapper=div({class:"frm-featured-form",children:[div({class:"frm-category-icon",icon:icon,backgroundColor:backgroundColor,role:"button"}),div({children:[tag("h3",{text:title,class:"view-type-title",role:"button"}),div({text:description,class:"view-type-description",
role:"button"})]})]});li.appendChild(wrapper);li.setAttribute("frm-view-type",type);return li}function handleSelectableMouseOver(){var icons,clone;icons=this.querySelector(".frm-hover-icons");if(null!==icons)icons.style.display="inline-block";else{clone=document.getElementById("frm-hover-icons-template").cloneNode(true);clone.id="";this.appendChild(clone)}}function handleSelectableMouseOut(){var icons=this.querySelector(".frm-hover-icons");if(null!==icons)icons.style.display="none"}function handleTableOptionSelect(){jQuery(this).closest(".frm-new-table-view-option").toggleClass("frm-selected-table-view-option",
this.checked)}if("undefined"!==typeof frmViewsDom){tag=frmViewsDom.tag;div=frmViewsDom.div;span=frmViewsDom.span;a=frmViewsDom.a;input=frmViewsDom.input;emptyNode=frmViewsDom.emptyNode;button=frmViewsDom.button;select=frmViewsDom.select;option=frmViewsDom.option;pullOptionsFrom=frmViewsDom.pullOptionsFrom}if("undefined"!==typeof frmViewsModal)maybeCreateModal=frmViewsModal.maybeCreateModal;if("undefined"!==typeof frmViewsUtil){post=frmViewsUtil.post;each=frmViewsUtil.each;map=frmViewsUtil.map}if("undefined"!==
typeof frmViewsTable)getTableSelectAllAndSearchOptions=frmViewsTable.getTableSelectAllAndSearchOptions;onClickPreventDefault("frm_new_view",onNewViewClick);jQuery(document).on("change",'.frm-new-table-view-option input[type="checkbox"]',handleTableOptionSelect);jQuery(document).on("mouseover",".frm-modal .frm-selectable",handleSelectableMouseOver);jQuery(document).on("mouseout",".frm-modal .frm-selectable",handleSelectableMouseOut)})();
